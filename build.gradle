plugins {
    id 'org.springframework.boot' version '1.5.1.RELEASE'
    id "com.moowork.gulp" version "1.1.1"
}

repositories {
    jcenter()
    mavenCentral()
}

task wrapper(type: Wrapper) {
    gradleVersion = '3.3'
}

node {
    // Version of node to use.
    version = '6.9.5'
    download = true
}

sourceCompatibility = 1.8
targetCompatibility = 1.8

version = '1.0.0'

dependencies {
    compile("org.springframework.boot:spring-boot-starter-security")
    compile("org.springframework.boot:spring-boot-starter-cache")
    compile("org.springframework.boot:spring-boot-starter-web")
    compile("org.springframework.boot:spring-boot-starter-websocket")

    // Needed to make the actuator hypermedia-based “discovery page” for the other endpoints work
    compile("org.springframework.boot:spring-boot-starter-hateoas")

    compile("org.springframework.boot:spring-boot-starter-actuator")
    compile("org.springframework.boot:spring-boot-actuator-docs")
    compile("org.springframework.boot:spring-boot-starter-data-jpa")
    compile("org.springframework.boot:spring-boot-starter-tomcat")
    compile("org.springframework.boot:spring-boot-devtools")

    compile("net.sf.ehcache:ehcache")
    compile("javax.el:javax.el-api:2.2.4")
    compile("commons-io:commons-io:2.5")
    compile("commons-collections:commons-collections:3.2.2")
    compile("org.apache.commons:commons-lang3:3.5")
    compile("org.apache.httpcomponents:httpclient:4.5.2")
    compile("org.webjars:sockjs-client:1.0.2")
    compile("org.webjars:stomp-websocket:2.3.3")
    testCompile("org.assertj:assertj-core:3.6.2")

    testCompile("org.springframework.boot:spring-boot-starter-test")

    runtime("com.h2database:h2")
    runtime("mysql:mysql-connector-java")
}

// Take over system properties.
// Needed to be able to set the active profile for Spring Boot
bootRun {
    systemProperties System.properties
}

// make sure node and gulp are installed before calling the build task in gulpfile.js
gulp_build.dependsOn 'installGulp'
gulp_build.dependsOn 'npmInstall'

//make sure gulp generates artifacts for the build
bootRun.dependsOn gulp_build
processResources.dependsOn gulp_build

//clean.delete << file('node_modules')